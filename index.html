<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Su Tesisleri Dairesi Başkanlığı Piezometre Hesaplama Tablosu</title>
  <style>
    /* STIL KISMI AYNEN KALDI */
    html, body { touch-action: none; }
    body {
      font-family: sans-serif;
      padding: 1rem;
      max-width: 1000px;
      margin: auto;
    }
    h2 {
      text-align: center;
      color: #8B0000;
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th { background-color: #f4f4f4; }
    input, select {
      width: 100%;
      padding: 6px;
      margin: 5px 0;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      border-radius: 5px;
      background-color: #008CBA;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover { background-color: #006F8E; }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px 0;
      gap: 5px;
    }
    .grafik-container {
      margin-top: 20px;
      width: 100%;
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
    }
    .boru-debi-tablosu {
      margin-top: 30px;
      width: 100%;
    }
  </style>
</head>
<body>
  <h2>Su Tesisleri Dairesi Başkanlığı Piezometre Hesaplama Tablosu</h2>

  <table>
    <thead>
      <tr>
        <th>Debi (L/s)</th>
        <th>Kot (m)</th>
        <th>Mesafe (m)</th>
        <th>Boru Çapı (mm)</th>
        <th>Atü (bar)</th>
        <th>Hız (m/s)</th>
        <th>İşletme Basıncı (m)</th>
      </tr>
    </thead>
    <tbody id="noktalarTablo">
    </tbody>
  </table>

  <div class="button-group">
    <button onclick="ekleNokta()">Nokta Ekle</button>
    <button onclick="hesapla()">Hesapla</button>
    <button onclick="exceleKaydet()">Excel'e Kaydet</button>
    <button onclick="grafikGoster()">Grafik Göster</button>
  </div>

  <div class="grafik-container">
    <canvas id="basincGrafik"></canvas>
  </div>

  <div>
    <h3>Boru Çapı / Debi / Ağırlık Tablosu</h3>
    <table class="boru-debi-tablosu">
      <thead>
        <tr>
          <th>Boru Çapı / Atü</th>
          <th>0,8 m/s Debi (l/s)</th>
          <th>1,0 m/s Debi (l/s)</th>
          <th>1,2 m/s Debi (l/s)</th>
          <th>Ağırlık (kg/m)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>32 / 10</td><td>0,49</td><td>0,62</td><td>0,74</td><td>0,19</td></tr>
        <tr><td>40 / 10</td><td>0,78</td><td>0,97</td><td>1,17</td><td>0,29</td></tr>
        <!-- DİĞER BORU ÇAPLARI BURAYA EKLENECEK -->
      </tbody>
    </table>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    // BORU TABLOSU VERİLERİ
    const boruTablosu = {
      "32": { "10": 28, "16": 26 },
      "40": { "10": 35.2, "16": 32.6 },
      // DİĞER BORU ÇAPLARI BURAYA EKLENECEK
    };

    let basincGrafik = null;
    const grafikData = {
      mesafeler: [],
      basincDegerleri: [],
      uyarilar: []
    };

    // NOKTALARI EKLEME FONKSİYONU
    function ekleNokta() {
      const tbody = document.getElementById('noktalarTablo');
      const row = document.createElement('tr');
      
      row.innerHTML = `
        <td><input type="number" class="debi" placeholder="Debi"></td>
        <td><input type="number" class="kot" placeholder="Kot"></td>
        <td><input type="number" class="mesafe" placeholder="Mesafe"></td>
        <td>
          <select class="boru">
            ${Object.keys(boruTablosu).map(c => `<option value="${c}">${c}</option>`).join('')}
          </select>
        </td>
        <td>
          <select class="atu">
            <option value="10">10</option>
            <option value="16">16</option>
          </select>
        </td>
        <td><input type="number" class="hiz" readonly></td>
        <td><input type="number" class="isletme" readonly></td>
      `;
      tbody.appendChild(row);
    }

    // HESAPLAMA FONKSİYONU
    function hesapla() {
      const rows = document.querySelectorAll("#noktalarTablo tr");
      let toplamYukKaybi = 0;
      let kumulatifMesafe = 0;
      
      grafikData.mesafeler = [];
      grafikData.basincDegerleri = [];
      grafikData.uyarilar = [];

      rows.forEach((row, i) => {
        const debi = parseFloat(row.querySelector(".debi").value) || 0;
        const kot = parseFloat(row.querySelector(".kot").value) || 0;
        const mesafe = parseFloat(row.querySelector(".mesafe").value) || 0;
        kumulatifMesafe += mesafe;

        // ... HESAPLAMALAR BURAYA ...

        grafikData.mesafeler.push(kumulatifMesafe);
        grafikData.basincDegerleri.push(isletmeBasinci);
        grafikData.uyarilar.push(uyari);
      });
    }

    // GRAFİK GÖSTERME FONKSİYONU
    function grafikGoster() {
      const ctx = document.getElementById('basincGrafik').getContext('2d');
      
      if (basincGrafik) {
        basincGrafik.destroy();
      }
      
      basincGrafik = new Chart(ctx, {
        type: 'line',
        data: {
          labels: grafikData.mesafeler.map(() => ""),
          datasets: [{
            label: 'İşletme Basıncı (m)',
            data: grafikData.basincDegerleri,
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: false }
          }
        }
      });
    }

    // EXCEL KAYDETME FONKSİYONU
    function exceleKaydet() {
      // ... EXCEL KAYDETME KODU ...
    }

    // SAYFA YÜKLENDİĞİNDE İLK NOKTALARI EKLE
    window.onload = function() {
      ekleNokta();
      ekleNokta(); // İki başlangıç noktası ekle
    };
  </script>
</body>
</html>