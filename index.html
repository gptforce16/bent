<!DOCTYPE html>  
<html lang="tr">  
<head>  
  <meta charset="UTF-8">  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">  
  <title>Su Tesisleri Dairesi Başkanlığı Piezometre Hesaplama Tablosu</title>  
  <style>  
    html, body {  
      touch-action: none;  
    }  
    body {  
      font-family: sans-serif;  
      padding: 1rem;  
      max-width: 1000px;
      margin: auto;  
    }  
    h2 {
      text-align: center;
      color: #8B0000;
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      word-wrap: break-word;
      white-space: normal;
      overflow-wrap: break-word;
    }
    th {
      background-color: #f4f4f4;
      font-size: 12px;
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin: 5px 0;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #ddd;
      font-size: 11px;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      border-radius: 5px;
      background-color: #008CBA;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #006F8E;
    }
    select.boru,
    select.atu {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: none;
      width: 100%;
      max-width: 250px;
      padding: 6px;
      margin: 5px 0;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #ddd;
      font-size: 12px;
    }
    .output {
      background: #f9f9f9;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    th, td {  
      width: 16%;  
    }  
    @media (max-width: 768px) {  
      table {  
        display: block;  
        overflow-x: auto;  
        white-space: nowrap;  
      }  
    }
    
    /* Boru Çapı/Debi Tablosu için özel stil */
    .boru-debi-tablosu {
      font-size: 11px;
    }
    .boru-debi-tablosu th, 
    .boru-debi-tablosu td {
      padding: 4px;
      font-size: 11px;
    }
    
    /* Buton grubu stili */
    .button-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      margin: 20px 0;
    }
    
    /* Grafik konteyner stili */
    .grafik-container {
      margin-top: 20px;
      width: 100%;
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    /* Uyarı renkleri */
    .vantuz {
      background-color: #FFD700 !important;
    }
    .tahliye {
      background-color: #87CEEB !important;
    }
    .dusuk-basinc {
      background-color: #FFA07A !important;
    }
  </style>  
</head>  
<body>  
  <h2>Su Tesisleri Dairesi Başkanlığı Piezometre Hesaplama Tablosu</h2>  
  
  <table>  
    <thead>  
      <tr>  
        <th>Debi (L/s)</th>  
        <th>Kot (m)</th>  
        <th>Mesafe (m)</th>  
        <th>Boru Çapı (mm)</th>  
        <th>Atü (bar)</th>  
        <th>Hız (m/s)</th>
        <th>İşletme Basıncı (m)</th>  
      </tr>  
    </thead>  
    <tbody id="noktalarTablo">  
    </tbody>  
  </table>

  <div class="button-group">
    <button onclick="ekleNokta()">Nokta Ekle</button>
    <button onclick="hesapla()">Hesapla</button>
    <button onclick="exceleKaydet()">Excel'e Kaydet</button>
    <button onclick="grafikGoster()">Grafik Göster</button>
  </div>

  <div class="grafik-container">
    <canvas id="basincGrafik"></canvas>
  </div>
  
  <div>
    <h3>Boru Çapı / Debi / Ağırlık Tablosu</h3>
    <table class="boru-debi-tablosu">
      <!-- ... Boru çapı tablosu içeriği aynı kalacak ... -->
    </table>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>  
    const boruTablosu = {
      // ... Boru tablosu verileri aynı kalacak ...
    };

    let basincGrafik = null;
    const grafikData = {
      mesafeler: [],
      basincDegerleri: [],
      uyarilar: []
    };

    function ekleNokta() {  
      // ... Nokta ekleme fonksiyonu aynı kalacak ...
    }  

    function hesapla() {  
      const rows = document.querySelectorAll("#noktalarTablo tr");  
      let toplamYukKaybi = 0;  
      let kumulatifMesafe = 0; // Kümülatif mesafe için
      const ilkKot = parseFloat(rows[0].querySelector(".kot").value) || 0;  
        
      grafikData.mesafeler = [];
      grafikData.basincDegerleri = [];
      grafikData.uyarilar = [];
    
      rows.forEach((row, i) => {  
        const kot = parseFloat(row.querySelector(".kot").value) || 0;  
        const mesafe = parseFloat(row.querySelector(".mesafe").value) || 0;  
        kumulatifMesafe += mesafe; // Kümülatif mesafe hesapla
        
        // ... Diğer hesaplamalar aynı ...
        
        // Grafik verilerini kaydet
        grafikData.mesafeler.push(kumulatifMesafe);
        grafikData.basincDegerleri.push(isletmeBasinci);
        grafikData.uyarilar.push(uyarı);
      });  
        
      grafikGoster();
    }

    function grafikGoster() {
      const ctx = document.getElementById('basincGrafik').getContext('2d');
      
      if (basincGrafik) {
        basincGrafik.destroy();
      }
      
      basincGrafik = new Chart(ctx, {
        type: 'line',
        data: {
          labels: grafikData.mesafeler.map(() => ""), // X ekseninde değer gösterme
          datasets: [{
            label: 'İşletme Basıncı (m)',
            data: grafikData.basincDegerleri,
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderWidth: 2,
            tension: 0.1,
            pointBackgroundColor: grafikData.uyarilar.map(uyari => {
              if (uyari === "Vantuz") return 'rgba(255, 215, 0, 0.7)';
              if (uyari === "Tahliye") return 'rgba(135, 206, 235, 0.7)';
              if (uyari === "Düşük Basınç") return 'rgba(255, 160, 122, 0.7)';
              return 'rgba(75, 192, 192, 0.7)';
            }),
            pointRadius: 6,
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                title: function(context) {
                  return `Kümülatif Mesafe: ${grafikData.mesafeler[context[0].dataIndex].toFixed(2)}m`;
                },
                label: function(context) {
                  return `Basınç: ${context.parsed.y.toFixed(2)}m`;
                },
                afterLabel: function(context) {
                  const index = context.dataIndex;
                  return grafikData.uyarilar[index] ? `Uyarı: ${grafikData.uyarilar[index]}` : '';
                }
              }
            },
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Kümülatif Mesafeye Göre İşletme Basıncı',
              font: {
                size: 16
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              title: {
                display: true,
                text: 'İşletme Basıncı (m)'
              }
            },
            x: {
              type: 'linear',
              position: 'bottom',
              title: {
                display: true,
                text: 'Kümülatif Mesafe (m)'
              },
              ticks: {
                display: false // X eksenindeki sayıları gizle
              },
              grid: {
                display: true // Çizgileri göster
              }
            }
          }
        }
      });
    }

    function exceleKaydet() {
      // ... Excel kaydetme fonksiyonu aynı kalacak ...
    }

    window.onload = function() {
      ekleNokta();
    };
  </script>  
</body>  
</html>